{"remainingRequest":"D:\\Work\\WorkSpace\\GitWorkSpace\\TenShop\\resource\\CinemaManager\\src\\CinemaManagerUserVue\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\Work\\WorkSpace\\GitWorkSpace\\TenShop\\resource\\CinemaManager\\src\\CinemaManagerUserVue\\src\\views\\pay\\BillDetail.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\Work\\WorkSpace\\GitWorkSpace\\TenShop\\resource\\CinemaManager\\src\\CinemaManagerUserVue\\src\\views\\pay\\BillDetail.vue","mtime":1693845914802},{"path":"D:\\Work\\WorkSpace\\GitWorkSpace\\TenShop\\resource\\CinemaManager\\src\\CinemaManagerUserVue\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1688268005356},{"path":"D:\\Work\\WorkSpace\\GitWorkSpace\\TenShop\\resource\\CinemaManager\\src\\CinemaManagerUserVue\\node_modules\\babel-loader\\lib\\index.js","mtime":1688268007045},{"path":"D:\\Work\\WorkSpace\\GitWorkSpace\\TenShop\\resource\\CinemaManager\\src\\CinemaManagerUserVue\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1688268005356},{"path":"D:\\Work\\WorkSpace\\GitWorkSpace\\TenShop\\resource\\CinemaManager\\src\\CinemaManagerUserVue\\node_modules\\vue-loader\\lib\\index.js","mtime":1688268007736}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CmltcG9ydCBtb21lbnQgZnJvbSAnbW9tZW50JwpleHBvcnQgZGVmYXVsdCB7CiAgbmFtZTogIkJpbGxEZXRhaWwiLAogIGRhdGEoKSB7CiAgICByZXR1cm4gewogICAgICBiaWxsSWQ6IHRoaXMuJHJvdXRlLnBhcmFtcy5iaWxsSWQsCiAgICAgIGJpbGxJbmZvOiB7CiAgICAgICAgc3lzU2Vzc2lvbjogewogICAgICAgICAgc3lzTW92aWU6IHt9LAogICAgICAgICAgc3lzSGFsbDogewogICAgICAgICAgICBzeXNDaW5lbWE6IHsKICAgICAgICAgICAgICB1c2VyOiB7fQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9LAogICAgICBiaWxsU2VhdHM6IFtdLAogICAgICBwYXlTdGF0ZTogbnVsbCwKICAgICAgY2FuY2VsU3RhdGU6IG51bGwsCiAgICAgIGNhbmNlbFRpbWU6IG51bGwsCiAgICAgIC8v6K6h5pe2CiAgICAgIG1pbnV0ZXM6IDEsCiAgICAgIHNlY29uZHM6IDAsCiAgICB9CiAgfSwKICBjcmVhdGVkKCkgewogICAgdGhpcy5nZXRCaWxsSW5mbygpCiAgfSwKICBtb3VudGVkKCkgewogICAgdGhpcy5hZGQoKQogIH0sCiAgbWV0aG9kczogewogICAgYXN5bmMgZ2V0QmlsbEluZm8oKSB7CiAgICAgIGNvbnN0IHsgZGF0YSA6IHJlcyB9ID0gYXdhaXQgYXhpb3MuZ2V0KCdzeXNCaWxsLycgKyB0aGlzLmJpbGxJZCkKICAgICAgaWYocmVzLmNvZGUgIT09IDIwMCkgcmV0dXJuIHRoaXMuJG1lc3NhZ2UuZXJyb3IoJ+iOt+WPluS/oeaBr+Wksei0pScpCiAgICAgIGxldCB1c2VySWQgPSBKU09OLnBhcnNlKHdpbmRvdy5zZXNzaW9uU3RvcmFnZS5nZXRJdGVtKCdsb2dpblVzZXInKSkudXNlcklkCiAgICAgIGlmICh1c2VySWQgIT09IHJlcy5kYXRhLnVzZXJJZCkgewogICAgICAgIHRoaXMuJGFsZXJ0KCfpnZ7ms5Xmk43kvZzvvIHmk43kvZzpnZ7mnKzkurrorqLljZXjgIInLCAn6Z2e5rOV5pON5L2c6K6i5Y2V6K2m5ZGKJywgewogICAgICAgICAgY29uZmlybUJ1dHRvblRleHQ6ICfmiJHnn6XpgZPkuoYnLAogICAgICAgICAgY2FsbGJhY2s6IGFjdGlvbiA9PiB7CiAgICAgICAgICAgIHRoaXMuJHJvdXRlci5wdXNoKCcvYmlsbCcpCiAgICAgICAgICB9CiAgICAgICAgfSkKICAgICAgICByZXR1cm4KICAgICAgfQogICAgICB0aGlzLmJpbGxJbmZvID0gcmVzLmRhdGEKCiAgICAgIHRoaXMuY2FuY2VsVGltZSA9IHRoaXMuYmlsbEluZm8uY2FuY2VsVGltZQogICAgICBjb25zb2xlLmxvZyh0aGlzLmJpbGxJbmZvKQogICAgICAvLyDmiKrmraLml7bpl7QKICAgICAgY29uc29sZS5sb2codGhpcy5iaWxsSW5mby5kZWFkbGluZSkKICAgICAgLy/lpITnkIborqLljZXluqfkvY3kv6Hmga8KICAgICAgdGhpcy5iaWxsU2VhdHMgPSBKU09OLnBhcnNlKHRoaXMuYmlsbEluZm8uc2VhdHMpCiAgICAgIHRoaXMucGF5U3RhdGUgPSB0aGlzLmJpbGxJbmZvLnBheVN0YXRlCiAgICAgIHRoaXMuY2FuY2VsU3RhdGUgPSB0aGlzLmJpbGxJbmZvLmNhbmNlbFN0YXRlCiAgICAgIGNvbnNvbGUubG9nKCd0aGUgY3JlYXRlX3RpbWUnK3RoaXMuYmlsbEluZm8uY3JlYXRlVGltZSkKICAgICAgdGhpcy5jb21wdXRlTGVmdFRpbWUoKQogICAgfSwKICAgIGFzeW5jIHBheUZvckJpbGwoKSB7CiAgICAgIC8v5pu05paw6K6i5Y2V54q25oCBCiAgICAgIHRoaXMuYmlsbEluZm8ucGF5U3RhdGUgPSB0cnVlCiAgICAgIC8v5pu05paw6K6i5Y2V5L+h5oGv5ZKM5Zy65qyh5bqn5L2N5L+h5oGvCiAgICAgIGF4aW9zLmRlZmF1bHRzLmhlYWRlcnMucHV0WydDb250ZW50LVR5cGUnXSA9ICdhcHBsaWNhdGlvbi9qc29uJwogICAgICBjb25zdCB7IGRhdGE6IHJlc30gPSBhd2FpdCBheGlvcy5wdXQoJ3N5c0JpbGwnLCBKU09OLnN0cmluZ2lmeSh0aGlzLmJpbGxJbmZvKSkKICAgICAgaWYocmVzLmNvZGUgIT09IDIwMCkgcmV0dXJuIHRoaXMuJG1lc3NhZ2UuZXJyb3IoJ+aUr+S7mOWksei0pScpCiAgICAgIHRoaXMucGF5U3RhdGUgPSB0cnVlCiAgICAgIHRoaXMuJGFsZXJ0KCfmlK/ku5jmiJDlip/vvIHmgqjlj6/ku6XliY3lvoDkuKrkurrkuK3lv4Pmn6XnnIvorqLljZXkv6Hmga8nLCAn5pSv5LuY6YCa55+lJywgewogICAgICAgIGNvbmZpcm1CdXR0b25UZXh0OiAn5oiR55+l6YGT5LqGJywKICAgICAgICBjYWxsYmFjazogYWN0aW9uID0+IHsKICAgICAgICAgIHRoaXMuJHJvdXRlci5wdXNoKCcvYmlsbCcpCiAgICAgICAgfQogICAgICB9KQogICAgfSwKICAgIGFzeW5jIGNhbmNlbEZvckJpbGwoKSB7CiAgICAgIC8v5pu05paw6K6i5Y2V54q25oCBCiAgICAgIHRoaXMuYmlsbEluZm8uY2FuY2VsU3RhdGUgPSB0cnVlCiAgICAgIHRoaXMuYmlsbEluZm8uY2FuY2VsVGltZSA9IG1vbWVudChuZXcgRGF0ZSgpKS5mb3JtYXQoJ1lZWVktTU0tREQgSEg6bW06c3MnKQogICAgICAvLyDojrflj5blnLrmrKHluqfkvY3kv6Hmga8KICAgICAgY29uc3QgeyBkYXRhIDogY3VyU2Vzc2lvbiB9ID0gYXdhaXQgYXhpb3MuZ2V0KCdzeXNTZXNzaW9uL2ZpbmQvJyArIHRoaXMuYmlsbEluZm8uc2Vzc2lvbklkKQogICAgICBsZXQgc2Vzc2lvblNlYXRzID0gSlNPTi5wYXJzZShjdXJTZXNzaW9uLmRhdGEuc2Vzc2lvblNlYXRzKQogICAgICAvLyDop6PmnpDlh7rorqLljZXpgInmi6nnmoTluqfkvY3vvIzmm7TmlrDluqfkvY3kv6Hmga8KICAgICAgZm9yKGxldCBzZWF0IG9mIHRoaXMuYmlsbFNlYXRzKXsKICAgICAgICBsZXQgcm93ID0gc2VhdC5zdWJzdHJpbmcoMCwgc2VhdC5pbmRleE9mKCfmjpInKSkKICAgICAgICBsZXQgY29sID0gTnVtYmVyLnBhcnNlSW50KHNlYXQuc3Vic3RyaW5nKHNlYXQuaW5kZXhPZign5o6SJykgKyAxLCBzZWF0Lmxlbmd0aCAtIDEpKQogICAgICAgIHNlc3Npb25TZWF0c1tyb3ddW2NvbCAtIDFdID0gMAogICAgICB9CiAgICAgIC8vIOabtOaWsOiuouWNleS/oeaBr+WSjOWcuuasoeW6p+S9jeS/oeaBrwogICAgICBheGlvcy5kZWZhdWx0cy5oZWFkZXJzLnB1dFsnQ29udGVudC1UeXBlJ10gPSAnYXBwbGljYXRpb24vanNvbicKICAgICAgY29uc3QgeyBkYXRhOiByZXMgfSA9IGF3YWl0IGF4aW9zLnB1dCgnc3lzQmlsbC9jYW5jZWwnLEpTT04uc3RyaW5naWZ5KHtzeXNCaWxsOiB0aGlzLmJpbGxJbmZvLCBzZXNzaW9uU2VhdHM6IEpTT04uc3RyaW5naWZ5KHNlc3Npb25TZWF0cyl9KSkKICAgICAgaWYocmVzLmNvZGUgIT09IDIwMCkgcmV0dXJuIHRoaXMuJG1lc3NhZ2UuZXJyb3IoJ+WPlua2iOWksei0pScpCgogICAgICB0aGlzLnBheVN0YXRlID0gZmFsc2UKICAgICAgdGhpcy5jYW5jZWxTdGF0ZSA9IHRydWUKICAgICAgdGhpcy4kYWxlcnQoJ+WPlua2iOaIkOWKn++8geaCqOWPr+S7peWJjeW+gOS4quS6uuS4reW/g+afpeeci+iuouWNleS/oeaBrycsICflj5bmtojpgJrnn6UnLCB7CiAgICAgICAgY29uZmlybUJ1dHRvblRleHQ6ICfmiJHnn6XpgZPkuoYnLAogICAgICAgIGNhbGxiYWNrOiBhY3Rpb24gPT4gewogICAgICAgICAgdGhpcy4kcm91dGVyLnB1c2goJy9iaWxsRGV0YWlsLycgKyB0aGlzLmJpbGxJbmZvLmJpbGxJZCkKICAgICAgICB9CiAgICAgIH0pCiAgICB9LAogICAgY29tcHV0ZUxlZnRUaW1lKCkgewogICAgICBsZXQgY3VyID0gbmV3IERhdGUoKQogICAgICBsZXQgY3JlYXRlVGltZSA9IG5ldyBEYXRlKHRoaXMuYmlsbEluZm8uY3JlYXRlVGltZSkKICAgICAgbGV0IGRpZmYgPSAxNSAqIDYwIC0gKGN1ciAtIGNyZWF0ZVRpbWUpIC8gMTAwMAogICAgICBpZiAoZGlmZiA8IDApIHsKICAgICAgICB0aGlzLm1pbnV0ZXMgPSAwCiAgICAgICAgdGhpcy5zZWNvbmRzID0gMAogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMubWludXRlcyA9IE1hdGguZmxvb3IoZGlmZiAvIDYwKQogICAgICAgIHRoaXMuc2Vjb25kcyA9IE1hdGguZmxvb3IoZGlmZiAlIDYwKQogICAgICB9CiAgICB9LAogICAgLy/orqHml7bovazmjaLmlbDlrZfmoLzlvI8KICAgIG51bTogZnVuY3Rpb24gKG4pIHsKICAgICAgcmV0dXJuIG4gPCAxMCA/ICcwJyArIG4gOiAnJyArIG4KICAgIH0sCiAgICAvL+iuoeaXtui1sOWKqAogICAgYWRkOiBmdW5jdGlvbiAoKSB7CiAgICAgIGxldCBfdGhpcyA9IHRoaXMKICAgICAgbGV0IHRpbWUgPSB3aW5kb3cuc2V0SW50ZXJ2YWwoZnVuY3Rpb24gKCkgewogICAgICAgIGlmIChfdGhpcy5zZWNvbmRzID09PSAwICYmIF90aGlzLm1pbnV0ZXMgIT09IDApIHsKICAgICAgICAgIF90aGlzLnNlY29uZHMgPSA1OQogICAgICAgICAgX3RoaXMubWludXRlcyAtPSAxCiAgICAgICAgfSBlbHNlIGlmIChfdGhpcy5taW51dGVzID09PSAwICYmIF90aGlzLnNlY29uZHMgPT09IDApIHsKICAgICAgICAgIF90aGlzLnNlY29uZHMgPSAwCiAgICAgICAgICB3aW5kb3cuY2xlYXJJbnRlcnZhbCh0aW1lKQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBfdGhpcy5zZWNvbmRzIC09IDEKICAgICAgICB9CiAgICAgIH0sIDEwMDApCiAgICB9LAogIH0sCiAgd2F0Y2g6IHsKICAgIHNlY29uZDogewogICAgICBoYW5kbGVyIChuZXdWYWwpIHsKICAgICAgICB0aGlzLm51bShuZXdWYWwpCiAgICAgIH0KICAgIH0sCiAgICBtaW51dGU6IHsKICAgICAgaGFuZGxlciAobmV3VmFsKSB7CiAgICAgICAgdGhpcy5udW0obmV3VmFsKQogICAgICB9CiAgICB9CiAgfSwKICBjb21wdXRlZDogewogICAgc2Vjb25kOiBmdW5jdGlvbiAoKSB7CiAgICAgIHJldHVybiB0aGlzLm51bSh0aGlzLnNlY29uZHMpCiAgICB9LAogICAgbWludXRlOiBmdW5jdGlvbiAoKSB7CiAgICAgIHJldHVybiB0aGlzLm51bSh0aGlzLm1pbnV0ZXMpCiAgICB9CiAgfQp9Cg=="},{"version":3,"sources":["BillDetail.vue"],"names":[],"mappings":";AAgHA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"BillDetail.vue","sourceRoot":"src/views/pay","sourcesContent":["<template>\n  <div>\n    <el-steps :active=\"3\" align-center>\n      <el-step title=\"选择影片场次\"></el-step>\n      <el-step title=\"选择座位\"></el-step>\n      <el-step title=\"15分钟内付款\"></el-step>\n      <el-step title=\"影院取票观影\" status=\"wait\"></el-step>\n    </el-steps>\n    <div class=\"bill-info-container\">\n      <!-- 订单状态 -->\n      <!-- 未支付，未取消，15分钟内 -->\n      <div class=\"bill-info-status\" v-if=\"payState === false && cancelState === false && (minutes > 0 || seconds > 0)\">\n        <div class=\"pay-icon\">\n          <img src=\"../../assets/money.png\">\n        </div>\n        <div class=\"pay-info\">\n          <div class=\"pay-info-status\">待支付</div>\n          <div class=\"pay-info-desc\">请在<span>{{minutes}}分钟{{seconds}}秒</span>内完成支付</div>\n        </div>\n      </div>\n      <!-- 未支付，超时取消，15分钟 -->\n      <div class=\"bill-info-status invalid\" v-if=\"payState === false && cancelState === true && cancelTime === null && minutes <= 0 && seconds <= 0\">\n        <div class=\"pay-icon\">\n          <img src=\"../../assets/bill-invalid.png\">\n        </div>\n        <div class=\"pay-info\">\n          <div class=\"pay-info-status invalid\">由于订单超时未支付，已失效</div>\n        </div>\n      </div>\n      <div class=\"bill-info-status finish\" v-if=\"payState === true\">\n        <div class=\"pay-icon\">\n          <i class=\"iconfont icon-r-yes\" style=\"color: #26CE61; font-size: 38px;\"> </i>\n        </div>\n        <div class=\"pay-info\">\n          <div class=\"pay-info-status finish\">已完成</div>\n        </div>\n      </div>\n      <div class=\"bill-info-status invalid\" v-if=\"cancelState === true && cancelTime !== null\">\n        <div class=\"pay-icon\">\n          <i class=\"iconfont icon-r-delete\" style=\"color: #f03d37; font-size: 38px;\"> </i>\n        </div>\n        <div class=\"pay-info\">\n          <div class=\"pay-info-status invalid\">订单已取消</div>\n        </div>\n      </div>\n\n      <!-- 订单信息 -->\n      <div class=\"bill-info-desc\">\n        <div class=\"bill-info-header\">\n          <span>订单编号: {{billInfo.billId}}</span>\n          <span class=\"bill-info-helper\">\n            (有订单问题可拨打客服电话<div>{{billInfo.sysSession.sysHall.sysCinema.cinemaPhone}}</div>，\n            工作时间: {{billInfo.sysSession.sysHall.sysCinema.workStartTime}}-{{billInfo.sysSession.sysHall.sysCinema.workEndTime}})</span>\n        </div>\n\n        <table class=\"order-table\">\n          <thead>\n          <tr>\n            <th>影片</th>\n            <th>语言版本</th>\n            <th>播放时间</th>\n            <th>座位</th>\n            <th>提示信息</th>\n          </tr>\n          </thead>\n          <tbody>\n          <tr>\n            <td class=\"movie-name\">《{{billInfo.sysSession.sysMovie.movieName}}》</td>\n            <td class=\"movie-name\">{{billInfo.sysSession.languageVersion}}</td>\n            <td class=\"showtime\">{{billInfo.sysSession.sessionDate}} {{billInfo.sysSession.playTime}} - {{billInfo.sysSession.endTime}}</td>\n            <td>\n              <span class=\"hall\">{{billInfo.sysSession.sysHall.hallName}}</span>\n              <div class=\"seats\">\n                <span class=\"bill-seat\" v-for=\"item in billSeats\" :key=\"item\"> {{item}} </span>\n              </div>\n            </td>\n            <td>\n              <span>{{billInfo.sysSession.sessionTips}}</span>\n            </td>\n          </tr>\n          </tbody>\n        </table>\n      </div>\n      <!-- 影院信息、提交订单 -->\n      <div class=\"bill-info-area\">\n        <div class=\"cinema-info\">\n          <span class=\"bill-cinema-name\">{{billInfo.sysSession.sysHall.sysCinema.cinemaName}}</span>\n          <div class=\"bill-cinema-info\">\n            <span>地址: {{billInfo.sysSession.sysHall.sysCinema.cinemaAddress}} </span>\n            <span>电话: {{billInfo.sysSession.sysHall.sysCinema.cinemaPhone}} </span>\n          </div>\n        </div>\n        <div class=\"submit-bill\">\n          <div>总价：<span>{{(billInfo.sysSession.sessionPrice * billSeats.length).toFixed(1)}}</span></div>\n          <div v-if=\"payState === false && cancelState === false && (minutes > 0 || seconds > 0)\">\n            <el-button @click=\"payForBill\" type=\"primary\" style=\"margin-top: 20px;font-size: 26px;\" round>\n              <i class=\"iconfont icon-r-yes\" style=\"font-size: 26px;\"></i>\n               立即支付\n            </el-button></div>\n          <div v-if=\"payState === false && cancelState === false && (minutes > 0 || seconds > 0)\">\n            <el-button @click=\"cancelForBill\" type=\"danger\" style=\"font-size: 26px; margin-top: 20px;\" round>\n              <i class=\"iconfont icon-r-left\" style=\"font-size: 26px;\"></i>\n               取消订单\n              </el-button>\n            </div>\n        </div>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script>\nimport moment from 'moment'\nexport default {\n  name: \"BillDetail\",\n  data() {\n    return {\n      billId: this.$route.params.billId,\n      billInfo: {\n        sysSession: {\n          sysMovie: {},\n          sysHall: {\n            sysCinema: {\n              user: {}\n            }\n          }\n        }\n      },\n      billSeats: [],\n      payState: null,\n      cancelState: null,\n      cancelTime: null,\n      //计时\n      minutes: 1,\n      seconds: 0,\n    }\n  },\n  created() {\n    this.getBillInfo()\n  },\n  mounted() {\n    this.add()\n  },\n  methods: {\n    async getBillInfo() {\n      const { data : res } = await axios.get('sysBill/' + this.billId)\n      if(res.code !== 200) return this.$message.error('获取信息失败')\n      let userId = JSON.parse(window.sessionStorage.getItem('loginUser')).userId\n      if (userId !== res.data.userId) {\n        this.$alert('非法操作！操作非本人订单。', '非法操作订单警告', {\n          confirmButtonText: '我知道了',\n          callback: action => {\n            this.$router.push('/bill')\n          }\n        })\n        return\n      }\n      this.billInfo = res.data\n\n      this.cancelTime = this.billInfo.cancelTime\n      console.log(this.billInfo)\n      // 截止时间\n      console.log(this.billInfo.deadline)\n      //处理订单座位信息\n      this.billSeats = JSON.parse(this.billInfo.seats)\n      this.payState = this.billInfo.payState\n      this.cancelState = this.billInfo.cancelState\n      console.log('the create_time'+this.billInfo.createTime)\n      this.computeLeftTime()\n    },\n    async payForBill() {\n      //更新订单状态\n      this.billInfo.payState = true\n      //更新订单信息和场次座位信息\n      axios.defaults.headers.put['Content-Type'] = 'application/json'\n      const { data: res} = await axios.put('sysBill', JSON.stringify(this.billInfo))\n      if(res.code !== 200) return this.$message.error('支付失败')\n      this.payState = true\n      this.$alert('支付成功！您可以前往个人中心查看订单信息', '支付通知', {\n        confirmButtonText: '我知道了',\n        callback: action => {\n          this.$router.push('/bill')\n        }\n      })\n    },\n    async cancelForBill() {\n      //更新订单状态\n      this.billInfo.cancelState = true\n      this.billInfo.cancelTime = moment(new Date()).format('YYYY-MM-DD HH:mm:ss')\n      // 获取场次座位信息\n      const { data : curSession } = await axios.get('sysSession/find/' + this.billInfo.sessionId)\n      let sessionSeats = JSON.parse(curSession.data.sessionSeats)\n      // 解析出订单选择的座位，更新座位信息\n      for(let seat of this.billSeats){\n        let row = seat.substring(0, seat.indexOf('排'))\n        let col = Number.parseInt(seat.substring(seat.indexOf('排') + 1, seat.length - 1))\n        sessionSeats[row][col - 1] = 0\n      }\n      // 更新订单信息和场次座位信息\n      axios.defaults.headers.put['Content-Type'] = 'application/json'\n      const { data: res } = await axios.put('sysBill/cancel',JSON.stringify({sysBill: this.billInfo, sessionSeats: JSON.stringify(sessionSeats)}))\n      if(res.code !== 200) return this.$message.error('取消失败')\n\n      this.payState = false\n      this.cancelState = true\n      this.$alert('取消成功！您可以前往个人中心查看订单信息', '取消通知', {\n        confirmButtonText: '我知道了',\n        callback: action => {\n          this.$router.push('/billDetail/' + this.billInfo.billId)\n        }\n      })\n    },\n    computeLeftTime() {\n      let cur = new Date()\n      let createTime = new Date(this.billInfo.createTime)\n      let diff = 15 * 60 - (cur - createTime) / 1000\n      if (diff < 0) {\n        this.minutes = 0\n        this.seconds = 0\n      } else {\n        this.minutes = Math.floor(diff / 60)\n        this.seconds = Math.floor(diff % 60)\n      }\n    },\n    //计时转换数字格式\n    num: function (n) {\n      return n < 10 ? '0' + n : '' + n\n    },\n    //计时走动\n    add: function () {\n      let _this = this\n      let time = window.setInterval(function () {\n        if (_this.seconds === 0 && _this.minutes !== 0) {\n          _this.seconds = 59\n          _this.minutes -= 1\n        } else if (_this.minutes === 0 && _this.seconds === 0) {\n          _this.seconds = 0\n          window.clearInterval(time)\n        } else {\n          _this.seconds -= 1\n        }\n      }, 1000)\n    },\n  },\n  watch: {\n    second: {\n      handler (newVal) {\n        this.num(newVal)\n      }\n    },\n    minute: {\n      handler (newVal) {\n        this.num(newVal)\n      }\n    }\n  },\n  computed: {\n    second: function () {\n      return this.num(this.seconds)\n    },\n    minute: function () {\n      return this.num(this.minutes)\n    }\n  }\n}\n</script>\n\n<style scoped>\n.el-step {\n  margin: 40px auto;\n}\n\n.bill-info-container{\n  width: 80%;\n  margin: 0 auto 40px auto;\n}\n\n.bill-info-status{\n  height: 120px;\n  background: #FFFBF2;\n  display: flex;\n  align-items: center;\n  margin-bottom: 40px;\n}\n\n.pay-icon{\n  width: 40px;\n  height:40px;\n  margin-left: 50px;\n}\n\n.pay-icon>img{\n  width: 100%;\n  height: 100%;\n}\n\n.pay-info{\n  display: flex;\n  flex-direction: column;\n  margin-left: 20px;\n}\n\n.pay-info-status{\n  color: #FAAF00;\n  font-size: 24px;\n  font-weight: 700;\n}\n\n.pay-info-desc{\n  color: #999;\n  font-size: 13px;\n}\n\n.pay-info-desc>span{\n  font-size: 16px;\n  color: #faaf00;\n  margin: 5px 5px;\n}\n\n.bill-info-status.finish{\n  background: #F4FFF8;\n}\n\n.bill-info-status.invalid{\n  background: #FFE0E0;\n}\n\n.pay-info-status.finish{\n  color: #26CE61;\n}\n\n.pay-info-status.invalid{\n  color: #faaaaa;\n}\n\n.bill-info-header{\n  display: flex;\n  justify-content: space-between;\n}\n\n.bill-info-header>span>div{\n  color: #f03d37;\n}\n\n.bill-info-helper{\n  color: #999;\n  font-size: 13px;\n  display: flex;\n  margin-bottom: 8px;\n}\n\n.order-table{\n  width: 100%;\n  border: 1px solid #e5e5e5;\n  border-spacing: 0;\n  margin-bottom: 60px;\n}\n\n.order-table thead {\n  background-color: #f7f7f7;\n}\n\n.order-table thead th {\n  font-size: 16px;\n  color: #333;\n  width: 20%;\n  padding: 14px 0;\n  font-weight: 400;\n}\n\n.order-table td {\n  text-align: center;\n  padding: 20px 0;\n  color: #333;\n}\n\n.order-table .movie-name {\n  font-size: 16px;\n}\n\n.order-table .showtime {\n  font-size: 14px;\n  color: #f03d37;\n}\n\n.order-table .cinema-name {\n  font-size: 14px;\n}\n\n.order-table .hall {\n  display: inline-block;\n  font-size: 14px;\n  color: #424242;\n  font-weight: 700;\n  margin-right: 10px;\n  vertical-align: top;\n}\n\n.order-table .seats {\n  display: inline-flex;\n  text-align: left;\n  flex-wrap: wrap;\n}\n\n.order-table .seats span{\n  margin-right: 5px;\n}\n\n.bill-info-area{\n  display: flex;\n  justify-content: space-between;\n}\n\n.bill-cinema-name{\n  font-weight: 700;\n}\n\n.bill-cinema-info{\n  display: flex;\n  flex-direction: column;\n  margin-top: 15px;\n}\n\n.submit-bill{\n  margin-top: 40px;\n}\n\n.submit-bill span{\n  color: #f03d37;\n  font-size: 32px;\n  font-weight: 700;\n}\n\n.submit-bill span:before{\n  content: '￥';\n  font-size: 20px;\n}\n</style>\n"]}]}